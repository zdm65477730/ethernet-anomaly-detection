%% 模型训练全流程（数据准备→训练→评估→部署）
flowchart TD
    A[开始] --> B[数据准备]
    
    subgraph 数据预处理
        B --> C[加载历史数据<br/>(特征+标签)]
        C --> D[数据清洗<br/>(去重/补缺失值)]
        D --> E[类别平衡<br/>(过采样/欠采样)]
        E --> F[特征标准化<br/>(Z-score/Min-Max)]
        F --> G[划分数据集<br/>(训练集80%/测试集20%)]
    end
    
    G --> H[模型选择<br/>(基于协议类型)]
    
    subgraph 模型训练
        H --> I{模型类型}
        I -->|传统模型| J[初始化XGBoost/随机森林<br/>(调参+交叉验证)]
        I -->|深度学习模型| K[初始化LSTM/MLP<br/>(构建网络+编译)]
        
        J --> L[训练模型<br/>(早停策略防过拟合)]
        K --> L
    end
    
    subgraph 模型评估
        L --> M[在测试集上评估]
        M --> N[计算核心指标<br/>(F1/精确率/召回率/AUC)]
        N --> O[生成评估报告<br/>(混淆矩阵/ROC曲线)]
    end
    
    subgraph 模型部署
        O --> P{性能达标?}
        P -->|是| Q[保存模型版本<br/>(含时间戳+指标)]
        P -->|否| R[调整参数<br/>& 重新训练]
        R --> J
        
        Q --> S[更新模型符号链接<br/>(latest → 新模型)]
        S --> T[通知检测模块<br/>加载新模型]
    end
    
    T --> U[结束]